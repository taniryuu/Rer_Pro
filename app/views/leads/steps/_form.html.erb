<%= form_with(model: [lead, step], local: true) do |form| %>
  <%= render 'devise/shared/error_messages', resource: @step %>

  <div class="field">
    <%= form.label :name %>＜入力必須＞
    <%= form.text_field :name, autofocus: true %>
  </div>

  <div class="field">
    <%= form.label :order %>＜入力必須＞
    <% if step.new_record? %>
      <%= form.number_field :order, min: 1, max: @lead.steps.count + 1, value: params[:order_num].to_i %>
    <% else %>
      <%= form.number_field :order, min: 1, max: @lead.steps.count %>
    <% end %>
  </div>

  <div class="field">
    <%= form.label :memo %>
    <%= form.text_area :memo, size: "50x3" %>
  </div>

----------------------------------------------------------------

  <% if @completed_step.present? %>

    <%= form.hidden_field :completed_id, value: @completed_step.id %>

    <div class="field">
      <%= form.label :status %>：進捗中
      <%= form.hidden_field :status, value: "in_progress" %>
    </div>
  
    <div class="field">
      <%= form.label :scheduled_complete_date %>＜入力必須＞
      <%= form.date_field :scheduled_complete_date, value: step.scheduled_complete_date %>
    </div>
  
  <% else %>
  
    <div class="field">
      <%= form.label :status %>
      <%= form.select :status, Step.statuses.keys.map { |k| [I18n.t("enums.step.status.#{k}"), k]} %>
    </div>
  
    <div class="field">
      <%= form.label :scheduled_complete_date %>
      <%= form.date_field :scheduled_complete_date, value: step.scheduled_complete_date %><br>
      ↑ 進捗中の進捗の場合、入力必須<br>
    </div>
  
    <div class="field">
      <%= form.label :completed_date %>
      <%= form.date_field :completed_date, value: step.completed_date %><br>
      ↑ 完了済の進捗の場合、入力必須<br>
    </div>
    
  <% end %>
----------------------------------------------------------------<br>
ここで一緒にタスクを追加、編集できると良い。<br>
----------------------------------------------------------------<br>
  <div class="actions">
    <%= form.submit %>
  </div>
<% end %>
